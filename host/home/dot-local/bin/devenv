#!/bin/bash

eval "$(/var/home/linuxbrew/.linuxbrew/bin/brew shellenv)"

set -euo pipefail

eval "$(/var/home/linuxbrew/.linuxbrew/bin/brew shellenv)"

PROJ_COLOR=$(echo -e "\x1b[1;36m")
RESET=$(echo -e "\x1b[0m")

FZF_CLI=$HOME/.local/bin/fzf-cli
PROJECTS_HOME=$HOME/Projects
TREE_DEPTH=3
TREE_BASE=trees

cd $PROJECTS_HOME

choice=(
  $(
    fd --strip-cwd-prefix --full-path --type=d --exact-depth=$TREE_DEPTH $TREE_BASE |
      sed 's"trees/""' |
      sed 's"/$""' |
      sed "s'\([^/]\+\)'$PROJ_COLOR\\1$RESET'" |
      $FZF_CLI --ansi |
      tr / "\n"
  ) 
)

if [[ -n $choice ]] ; then
  cd $PROJECTS_HOME/${choice[0]}/trees/${choice[1]}
  distrobox enter ${choice[0]} -- kitty --detach
fi
