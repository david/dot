#!/bin/bash

SYS_DIR=$HOME/Projects/sys/trunk
OLD_UMASK=$(umask)

function container_config_root {
  umask 0022
  ansible-playbook $SYS_DIR/container-root.yml
}

function container_config_user {
  umask $OLD_UMASK
  ansible-playbook $SYS_DIR/container-user.yml
}

case $1 in
  config)
    ansible-playbook $SYS_DIR/config.yml
    ;;

  container)
    case $2 in
      root)
        container_config_root
        ;;

      user)
        container_config_user
        ;;

      *)
        container_config_root
        container_config_user
        ;;
    esac
    ;;

  *)
    if [[ -v CONTAINER_ID ]]; then
      container_config_root
      container_config_user
    fi
    ;;
esac
