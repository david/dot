home_prefix = "~/Homes"

template :box do |t|
  t.image "ghcr.io/ublue-os/arch-toolbox:latest"

  t.locale "en_US.UTF-8", "pt_PT.UTF-8"

  t.source "chaotic-aur",
    key: "3056513887B78AEB",
    keyserver: "keyserver.ubuntu.com",
    mirrorlist: "chaotic-mirrorlist",
    packages: [
      "https://cdn-mirror.chaotic.cx/chaotic-aur/chaotic-keyring.pkg.tar.zst",
      "https://cdn-mirror.chaotic.cx/chaotic-aur/chaotic-mirrorlist.pkg.tar.zst"
    ]

  t.link "config/*", "~/.config"
  t.link "home/*", -> filename { "~/.#{File.basename(filename)}" }

  t.package %w[
    base-devel
    bat
    bitwarden-cli
    blesh-git
    eza
    fd
    fzf
    github-cli
    inotify-tools
    jq
    lazydocker
    lazygit
    libyaml
    mise
    neovide
    python-uv
    ripgrep
    starship
    ttf-jetbrains-mono
    ttf-nerd-fonts-symbols
    usage
    wl-clipboard
    yay
  ]

  t.package "f1bonnacci/process-compose"

  t.volume "~/.local/share/nvim", "~/.local/share/nvim"
end

template :webapp do |t|
  t.package "axllent/mailpit"
end

box :tina, template: [:box, :webapp] do |b|
  b.home "#{home_prefix}/tina"

  b.package %w[heroku-cli qpdf]

  b.export "neovide",
    label: "Neovide [tina]",
    command: "bash -c 'source ~/.profile && cd main && mise exec -- neovide'"
end

box :lino, template: [:box, :webapp] do |b|
  b.home "#{home_prefix}/lino"

  b.package %w[ansible docker python-requests python-jsondiff]

  b.export "neovide",
    label: "Neovide [lino]",
    command: "bash -c 'source ~/.profile && cd main && mise exec -- neovide'"
end

box :habitat, template: :box do |b|
  b.home "#{home_prefix}/habitat"

  b.export "neovide",
    label: "Neovide [habitat]",
    command: "bash -c 'source ~/.profile && cd main && mise exec -- neovide'"
end

# vim: ft=ruby
